version: '3.8'

services:
  rng:
    image: ghcr.io/happybigmtn/rng:v1.0.0
    container_name: rng
    restart: unless-stopped
    
    # CPU limits (~50% by default)
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 2G
    
    volumes:
      - rng-data:/home/rng/.rng
    
    # Expose P2P port (RPC stays internal for security)
    ports:
      - "8433:8433"  # P2P
      # Uncomment to expose RPC (NOT recommended for production):
      # - "127.0.0.1:8432:8432"
    
    # Health check
    healthcheck:
      test: ["CMD", "rng-cli", "getblockchaininfo"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  rng-data:
    driver: local

# Usage:
# ------
# Start:
#   docker-compose up -d
#
# Check status:
#   docker-compose exec rng rng-cli getblockchaininfo
#
# Create wallet:
#   docker-compose exec rng rng-cli createwallet "miner"
#
# Get address:
#   docker-compose exec rng rng-cli -rpcwallet=miner getnewaddress
#
# Mine a block:
#   docker-compose exec rng rng-cli -rpcwallet=miner generatetoaddress 1 "YOUR_ADDRESS"
#
# View logs:
#   docker-compose logs -f rng
#
# Stop:
#   docker-compose down
#
# Stop and remove data:
#   docker-compose down -v
